<!-- app.component.html -->
<div class="container">
  <button (click)="open()" id="template" nz-button nzType="primary">å¿«æ·æ¨¡æ¿</button>
  <button (click)="openHistory()" id="history" nz-button nzType="primary">å†å²è®°å½•</button>
  <div *ngIf="!ifAsk" id="container">
    <div id="greeting">
      Hiï¼
    </div>
    <div id="welcome-message">
      æ¬¢è¿ä½¿ç”¨é—®ç­”BotğŸ¤–ï¼Œä¸ä½¿ç”¨GPT3.5-Turboä¸€æ ·
    </div>
    <div id="fun">
      Any Questions&nbsp;&&nbsp;Have Fun
    </div>
  </div>
  <div #AiResult>
    <nz-list *ngIf="data.length" [nzDataSource]="data" [nzRenderItem]="item" [nzItemLayout]="'horizontal'">
      <ng-template #item let-item>
        <nz-comment [nzAuthor]="item.author">
          <nz-avatar nz-comment-avatar nzIcon="robot"></nz-avatar>
          <nz-comment-content>
            <p >{{ item.content }}</p>
            <div id="chatbox">
              <p  id="aiResponse"></p>
            </div>
          </nz-comment-content>
        </nz-comment>
      </ng-template>
    </nz-list>
  </div>
  <input id="inputPrompt" type="text" nz-input [(ngModel)]="prompt" placeholder="è¯·è¾“å…¥ä½ çš„é—®é¢˜">
  <button nz-button nzType="primary" [nzLoading]="submitting" [disabled]="!prompt" id="send" (click)="sendPost()">å‘é€</button>
  <button nz-button nzType="primary" [nzLoading]="replying" [disabled]="!replyDone" id="reply" (click)="sendToEditor()">
    è½¬å­˜
  </button>
  <button (click)="recordToService()" [disabled]="!replyDone" [nzLoading]="replying" id="record" nz-button
          nzType="primary">
    è®°å½•
  </button>
</div>
<nz-drawer
  [nzClosable]="false"
  [nzOffsetX]="childrenVisible ? 180 : 0"
  [nzWidth]="320"
  [nzVisible]="visible"
  nzTitle="å¿«æ·æé—®æ¨¡æ¿"
  (nzOnClose)="close()"
>
  <form *nzDrawerContent nz-form>
    <div nz-row>
      <div nz-col nzSpan="24">
        <nz-form-item>
          <nz-form-control>
            <button (click)="openModal(TemplateModal)" id="postReply" nz-button nzType="primary" style="width: 275px">
              æ·»åŠ æ¨¡æ¿
            </button>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
    <div nz-row>
      <div nz-col nzSpan="24">
        <nz-form-item>
          <nz-form-control>
            <nz-list nzItemLayout="horizontal">
              @for (item of listOfTemplate;track item) {
                <nz-list-item>
                  <nz-card style="width: 300px">
                    <nz-card-meta
                      nzTitle="å¿«æ·æé—®æ¨¡æ¿"
                      [nzDescription]="item.tempContent"
                    ></nz-card-meta>
                    <button nz-button nzDanger nz-popconfirm
                            nzPopconfirmTitle="ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¨¡æ¿å—?"
                            (nzOnConfirm)="deleteTemp(item.tempId)"
                            (nzOnCancel)="cancel()"
                            nzPopconfirmPlacement="topLeft" style="width: 90px; margin-top: 20px;margin-left: 15px">åˆ é™¤æ¨¡æ¿
                    </button>
                    <button nz-button nzType="primary" (click)="useTemp(item.tempContent)"
                            style="width: 90px; margin-top: 20px;margin-left: 20px">ä½¿ç”¨æ¨¡æ¿
                    </button>
                  </nz-card>
                </nz-list-item>
              }
              @if (data.length === 0) {
                <nz-list-empty/>
              }
            </nz-list>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
  </form>
</nz-drawer>

<nz-drawer
  (nzOnClose)="closeHistory()"
  [nzClosable]="false"
  [nzOffsetX]="childrenVisibleHistory ? 180 : 0"
  [nzVisible]="visibleHistory"
  [nzWidth]="736"
  nzTitle="ä¿å­˜çš„å†å²è®°å½•"
>
  <form *nzDrawerContent nz-form>
    <div nz-row>
      <div nz-col nzSpan="24">
        <nz-form-item>
          <nz-form-control>
            <nz-list nzItemLayout="horizontal">
              @for (item of listOfHistory;track item) {
                <nz-list-item>
                  <nz-card style="width: 690px;margin-top: 6px">
                    <nz-card-meta
                      nzTitle="å†å²è®°å½•"
                      [nzDescription]="item.historyContent"
                    ></nz-card-meta>
                    <button nz-button nzDanger nz-popconfirm
                            nzPopconfirmTitle="ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—?"
                            (nzOnConfirm)="deleteHistory(item.historyId)"
                            (nzOnCancel)="cancel()"
                            nzPopconfirmPlacement="topLeft" style="margin-left: 40px;width: 250px; margin-top: 20px">
                      åˆ é™¤è®°å½•
                    </button>
                    <button nz-button nzType="primary" (click)="sendToEditorHistory(item.historyContent)"
                            style="margin-left: 60px;width: 250px; margin-top: 20px">è½¬å­˜è®°å½•
                    </button>
                  </nz-card>
                </nz-list-item>
              }
              @if (data.length === 0) {
                <nz-list-empty/>
              }
            </nz-list>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
  </form>
</nz-drawer>
<ng-template #TemplateModal let-modal>

  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">æ·»åŠ æ¨¡æ¿</h4>
    <button (click)="modal.dismiss('Cross click')" aria-label="Close" class="close" nz-button nzDanger>
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <nz-comment>
      <nz-comment-content>
        <nz-form-item>
          <textarea [(ngModel)]="TemplateInputValue" nz-input rows="4"></textarea>
        </nz-form-item>
      </nz-comment-content>
    </nz-comment>
  </div>
  <div class="modal-footer">
    <button (click)="submitTemplate()" (click)="modal.dismiss('Cross click')" [disabled]="!TemplateInputValue" [nzLoading]="submitting"
            nz-button
            nzType="primary">
      æ·»åŠ 
    </button>
  </div>
</ng-template>
